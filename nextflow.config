/*******************************************************************************
********************** Config File for PhyloMagnet *****************************
*******************************************************************************/
params {
    project_list = ""
    is_runs = false
    fastq = ""

    local_ref = ""
    megan_vmoptions = "MEGAN.vmoptions"
    reference_classes = ""
    reference_packages = ""

    database = "ena" // or "ncbi"
    phylo_method = "fasttree" // or "iqtree" or "raxml"
    align_method = "mafft-fftnsi" // or any "mafft" command or "prank"
    cpus = 4
    reference_dir = "references/"
    queries_dir = "queries/"
    lineage = "Rickettsiales" // also a comma-separated list is valid
    megan_dir = "/usr/local/megan"
    python3 = "/usr/bin/python3"
}

docker {
    remove = true
    fixOwnership = true
}

singularity {
    enabled = true
    autoMounts = true
}

executor {
    queueSize = 30
    memory = '120 GB'
}

process {
    errorStrategy = 'finish'
    $downloadFastQ {
        errorStrategy = 'retry'
        maxRetries = 3
        maxForks = 4
        cpus = 1
    }
    $downloadEggNOG {
        maxForks = 10
        errorStrategy = 'retry'
        maxRetries = 2
        cpus = 1
    }
    $alignFastQFiles {
        memory = '50 GB'
        cpus = { params.cpus / 2 >= 4 ? params.cpus / 2 : params.cpus / 1 }
        maxForks = { params.cpus / 2 >= 4 ?  2 : 1 }
    }
    $meganizeDAAFiles {
        memory = '20 GB'
        cpus = { params.cpus / 4 >= 1 ? params.cpus / 4 : params.cpus / 1 }
        maxForks = { params.cpus / 4 >= 1 ?  4 : 1 }
    }
    $geneCentricAssembly {
        memory = '20 GB'
        cpus = { params.cpus / 4 >= 1 ? params.cpus / 4 : params.cpus / 1 }
        maxForks = { params.cpus / 4 >= 1 ?  4 : 1 }
    }
    $alignReferences {
        cpus = { params.cpus / 4 >= 1 ? params.cpus / 4 : params.cpus / 1 }
        maxForks = { params.cpus / 4 >= 1 ?  4 : 1 }
    }
    $buildTreefromReferences {
        memory = '5 GB'
        cpus = { params.cpus / 10 >= 1 ?  params.cpus / 10 : params.cpus / 1 }
        maxForks = { params.cpus / 10 >= 1 ?  10 : 1 }
    }
    $alignQueriestoRefMSA {
        cpus = { params.cpus / 10 >= 1 ?  params.cpus / 10 : params.cpus / 1 }
        maxForks = { params.cpus / 10 >= 1 ?  10 : 1 }
    }
    $placeContigsOnRefTree {
        cpus = { params.cpus / 4 >= 1 ?  params.cpus / 4 : params.cpus / 1 }
        maxForks = { params.cpus / 4 >= 1 ?  4 : 1 }
    }
    $assignContigs {
        cpus = { params.cpus / 10 >= 1 ?  params.cpus / 10 : params.cpus / 1 }
        maxForks = { params.cpus / 10 >= 1 ?  10 : 1 }
    }
    $magnetizeTrees {
        cpus = 1
    }
}
